/*~~~~~~~~
with Ds.plugins

	toolsName:followSlide

	version:1.1

	firstDate:2012.06.22

	lastDate:2012.06.27-14:35

	effect:[
		+.{effects},
		+.{effects}
	];

	log:{
		"v1.0":[
			+.移植自 Ds.followSlide_1.2
			+.{logs}
		],
		"v1.1":[
			+.修正 传入参数 nViewWidth 为非 "px" 单位 , 初始化不正确的bug
			+.改变 dsFollowSlide-btn 包裹元素为 span , 防止传入 <a>Aword</a> 的意外结构
			+.修正 当为最后一张的时候,点击第一张 出现回滚的bug
			+.清理 dances.followSlide.css 不适用灵活项目的css
		]
	}

~~~~~~~~*/

/*~~~~~~~~
Usage

html construct:
	<div class="dsFollowSlide">
		<div class="dsFollowSlide-view">
			<ul class="dsFollowSlide-con">
				<li> your content design </li>
				<li> your content design </li>
				<li> your content design </li>
				<li> your content design </li>
			</ul>
		</div>
		<ul class="dsFollowSlide-navi">
			<li>1</li>
			<li>2</li>
			<li>3</li>
		</ul>
		<span class="dsFollowSlide-btn dsFollowSlide-prev">prev</span>
		<span class="dsFollowSlide-btn dsFollowSlide-next">next</span>
	</div>

	.dsFollowSlide-view 与 .dsFollowSlide-con 必须定义,其挂钩会被扩展内部享用.
	div.dsFollowSlide-view 定义 视口的结构
	div.dsFollowSlide-con 定义 每个小单元的包裹结果

	ul.dsFollowSlide-navi 与 span.dsFollowSlide-btn
	皆为动态生成


js invoke:
	$(".dsFollowSlide").followSlide({
			nViewWidth: "320",			// 指定 slide 宽度 (默认自动获取,lazy 默认请指定 或 在 css指定 .dsFollowSlide-con li 大小)
			nViewHeight: "180",			// 指定 slide 高度 (默认自动获取,lazy 默认请指定 或 在 css指定 .dsFollowSlide-con li 大小)

			nHoldTime:2000,				// 指定 两帧动画之间的间隔时间 (默认 2000 毫秒)
			nAnimateTime:500,			// 一帧动画的时间 (默认 450 毫秒)

			bVertical:true,				// 是否为垂直动画(默认为 false)
			bReverseAnimate:false,		// 移动方向是否反向 (默认为 false)
			bHoverStop:true,			// 鼠标悬停是否停止动画 (默认为 true)

			bNavi:true,					// 是否开启上下页导航 (默认为 false)
			bNumericNavi:true,			// 是否开启数字导航 (默认为 true)

			bAuto:true,					// 应用实例自动动画 (默认为 true)
			bLazy:true,					// 开启 延迟加载 (默认 false)
			sLazySrc:true,				// 指定 lazysrc 地址 (默认 "_src")

			_sContentcClass:"current",	// 指定当前盒子内容的 className (默认 "current")
			_sNavicHook:"current",		// 指定当前数字导航的 className (默认 "current")

			prevHTML : "prev",			// 上一页的 html (默认 "prev")
			nextHTML : "next"			// 下一页的 html (默认 "next")
	});


~~~~~~~~*/

(function(){if(!window.jQuery){throw ("[Need jQuery or other library]")}var a,c,d,b;$.prototype.followSlide=function(e){var f=this;e=$.extend({nViewWidth:"",nViewHeight:"",nHoldTime:2000,_nHoldTimeShift:false,_nHoldTimeSpeedUp:false,nAnimateTime:450,_nAnimateShift:0.5,bNavi:false,bNumericNavi:true,bHoverStop:true,bAuto:true,bReverseAnimate:false,bVertical:false,bLazy:false,sLazySrc:"_src",_sContentcClass:"current",_sNavicHook:"current",prevHTML:"prev",nextHTML:"next"},e);return f.each(function(){var n={},k=jQuery,o=k(this).css({position:"relative"}).addClass("dsFollowSlide"),p=k(".dsFollowSlide-view",this),v=k(".dsFollowSlide-con",this).css({position:"absolute",overflow:"visible"}),r=v.children(),w,m,u,l,t,j,g,i=e.bLazy?e.sLazySrc:false,q=e._sNavicHook?e._sNavicHook:"",s=e._sContentcClass?e._sContentcClass:"",h;if(r.length<2){return"number is less"}n.trueLength=r.length;j=r.first().width();g=r.first().height();p.css({width:e.nViewWidth||j,height:e.nViewHeight||g,position:"relative",overflow:"hidden"});if(e.bVertical){if(e.bReverseAnimate){n.mode="t2b"}else{n.mode="b2t"}}else{if(e.bReverseAnimate){n.mode="l2r"}else{n.mode="r2l"}}if(!e.bVertical){v.css({width:j*(n.trueLength+1)})}switch(n.mode){case"r2l":m=v.css({left:0}).append(r.first().clone()).prepend(r.last().clone().css({marginLeft:-j})).children();break;case"l2r":a(v);m=v.css({left:-j*(n.trueLength-1)}).prepend(r.first().clone().css({marginLeft:-j})).append(r.last().clone()).children();break;case"b2t":m=v.css({top:0}).append(r.first().clone()).prepend(r.last().clone().css({marginTop:-g})).children();break;case"t2b":a(v);m=v.css({top:-g*(n.trueLength-1)}).prepend(r.first().clone().css({marginTop:-g})).append(r.last().clone()).children();break}k(".dsFollowSlide-navi",o).remove();if(e.bNumericNavi){u=c(o,e,n);l=u.children();k("li",u).bind("click.follow",function(){n.hovring=true;var x;if(n.ing){return false}x=k(this).index();if(n.whichOne===x){return false}clearTimeout(n.t);if(i){if(!n.lazyCache[x]){b(r.eq(x),i);n.lazyCache[x]=true}}if(0===x&&n.trueLength===(n.whichOne+1)){x=n.trueLength}h(x);return false})}k(".dsFollowSlide-btn",o).remove();if(e.bNavi){d(o,e);t=o.find(".dsFollowSlide-btn").bind("click.follow",function(){if(n.ing){return false}var x=(k(this).hasClass("dsFollowSlide-next")?1:-1)+n.whichOne;if(i&&!n.lazyCache[x]){b(r.eq(x),i);n.lazyCache[x]=true}clearTimeout(n.t);h(x);return false})}h=function(x){x=("undefined"!==typeof x)?x:1;switch(n.mode){case"r2l":h=function(y){n.ing=true;v.animate({left:-j*y},{duration:e.nAnimateTime,complete:function(){n.whichOne=y;n.ing=false;if(y>=n.trueLength){n.whichOne=y=0;v.css({left:0});if(e.bNumericNavi){l.filter("."+q).removeClass();l.eq(0).addClass(q)}}else{if(y<0){n.whichOne=y=n.trueLength-1;v.css({left:-j*(n.trueLength-1)});if(e.bNumericNavi){l.filter("."+q).removeClass();l.eq(n.trueLength-1).addClass(q)}}else{if(e.bNumericNavi){l.filter("."+q).removeClass();l.eq(y).addClass(q)}}}r.filter("."+s).removeClass(s).end().eq(y).addClass(s);if(i){if(!n.lazyCache[y+1]){b(r.eq(y+1),i);n.lazyCache[y+1]=true}}if(e.bHoverStop&&n.hovring){clearTimeout(n.t);return"holdIt"}n.t=setTimeout(function(){h(++y)},e.nHoldTime)}})};break;case"l2r":h=function(y){n.ing=true;v.animate({left:-j*(n.trueLength-y-1)},{duration:e.nAnimateTime,complete:function(){n.whichOne=y;n.ing=false;if(y>=n.trueLength){n.whichOne=y=0;v.css({left:-j*(n.trueLength-1)});if(e.bNumericNavi){l.filter("."+q).removeClass();l.eq(0).addClass(q)}}else{if(y<0){n.whichOne=y=n.trueLength-1;v.css({left:0});if(e.bNumericNavi){l.filter("."+q).removeClass();l.eq(n.trueLength-1).addClass(q)}}else{if(e.bNumericNavi){l.filter("."+q).removeClass();l.eq(y).addClass(q)}}}r.filter("."+s).removeClass(s).end().eq(y).addClass(s);if(i){if(!n.lazyCache[y+1]){b(r.eq(y+1),i);n.lazyCache[y+1]=true}}if(e.bHoverStop&&n.hovring){clearTimeout(n.t);return"holdIt"}n.t=setTimeout(function(){h(++y)},e.nHoldTime)}})};break;case"b2t":h=function(y){n.ing=true;v.animate({top:-g*y},{duration:e.nAnimateTime,complete:function(){n.whichOne=y;n.ing=false;if(y>=n.trueLength){n.whichOne=y=0;v.css({top:0});if(e.bNumericNavi){l.filter("."+q).removeClass();l.eq(0).addClass(q)}}else{if(y<0){n.whichOne=y=n.trueLength-1;v.css({top:-g*(n.trueLength-1)});if(e.bNumericNavi){l.filter("."+q).removeClass();l.eq(n.trueLength-1).addClass(q)}}else{if(e.bNumericNavi){l.filter("."+q).removeClass();l.eq(y).addClass(q)}}}r.filter("."+s).removeClass(s).end().eq(y).addClass(s);if(i){if(!n.lazyCache[y+1]){b(r.eq(y+1),i);n.lazyCache[y+1]=true}}if(e.bHoverStop&&n.hovring){clearTimeout(n.t);return"holdIt"}n.t=setTimeout(function(){h(++y)},e.nHoldTime)}})};break;case"t2b":h=function(y){n.ing=true;v.animate({top:-g*(n.trueLength-y-1)},{duration:e.nAnimateTime,complete:function(){n.whichOne=y;n.ing=false;if(y>=n.trueLength){n.whichOne=y=0;v.css({top:-g*(n.trueLength-1)});if(e.bNumericNavi){l.filter("."+q).removeClass();l.eq(0).addClass(q)}}else{if(y<0){n.whichOne=y=n.trueLength-1;v.css({top:0});if(e.bNumericNavi){l.filter("."+q).removeClass();l.eq(n.trueLength-1).addClass(q)}}else{if(e.bNumericNavi){l.filter("."+q).removeClass();l.eq(y).addClass(q)}}}r.filter("."+s).removeClass(s).end().eq(y).addClass(s);if(i){if(!n.lazyCache[y+1]){b(r.eq(y+1),i);n.lazyCache[y+1]=true}}if(e.bHoverStop&&n.hovring){clearTimeout(n.t);return"holdIt"}n.t=setTimeout(function(){h(++y)},e.nHoldTime)}})};break}h(x)};if(i){b(r.eq(0).addClass(s).add(r.eq(1)).add(r.eq(n.trueLength-1)).add(m.first()).add(m.last()),i);n.lazyCache={"-1":true,0:true,1:true};n.lazyCache[n.trueLength-1]=true;n.lazyCache[n.trueLength]=true}n.whichOne=0;if(e.bAuto){n.t=setTimeout(function(){h()},e.nHoldTime)}if(e.bHoverStop){o.hover(function(){clearTimeout(n.t);n.hovring=true},function(){clearTimeout(n.t);n.hovring=false;if(n.ing){return"protected"}n.t=setTimeout(function(){h(n.whichOne+1)},e.nHoldTime)})}w=null})};a=function(g){var e=g.children(),f=g.children().length-1;do{e.eq(0).insertAfter(e.eq(f));e=g.children()}while(--f);g.show();e=null;return g};c=function(j,f,h){var k='<ul class="dsFollowSlide-navi">',g=0,e=h.trueLength;do{k+='<li><a href="#">'+(g+1)+"</a></li>"}while(++g<e);k+="</ul>";k=$(k);k.children().first().addClass(f._sNavicHook);j.append(k);k=null;return j.find(".dsFollowSlide-navi")};d=function(f,e){f.append('<span class="dsFollowSlide-btn dsFollowSlide-prev">'+e.prevHTML+'</span><span class="dsFollowSlide-btn dsFollowSlide-next">'+e.nextHTML+"</span>")};b=function(e,f){if(!e.length){return}e.find("img").each(function(){var g=this.getAttribute(f);if(!g){return"ignore"}this.src=g;this.removeAttribute(f)})}})();
